(function(f){var b={canvas:true};var c,d,a;var e=Object.prototype.hasOwnProperty;function g(j,i){var h=i.Canvas;if(c==null){d=h.prototype.getTextInfo,a=h.prototype.addText,c=h.prototype.render}h.prototype.render=function(){if(!j.getOptions().canvas){return c.call(this)}var m=this.context,k=this._textCache;m.save();m.textBaseline="middle";for(var s in k){if(e.call(k,s)){var l=k[s];for(var r in l){if(e.call(l,r)){var o=l[r],p=true;for(var t in o){if(e.call(o,t)){var n=o[t];if(!n.active){delete o[t];continue}if(p){m.fillStyle=n.font.color;m.font=n.font.definition;p=false}var v=n.lines;for(var q=0;q<v.length;++q){var u=v[q];m.fillText(u.text,u.x,u.y)}}}}}}}m.restore()};h.prototype.getTextInfo=function(s,w,o,p){if(!j.getOptions().canvas){return d.call(this,s,w,o,p)}var t,k,m,n;w=""+w;if(typeof o==="object"){t=o.style+" "+o.variant+" "+o.weight+" "+o.size+"px "+o.family}else{t=o}k=this._textCache[s];if(k==null){k=this._textCache[s]={}}m=k[t];if(m==null){m=k[t]={}}n=m[w];if(n==null){var l=this.context;if(typeof o!=="object"){var r=f("<div>&nbsp;</div>").css("position","absolute").addClass(typeof o==="string"?o:null).appendTo(this.getTextLayer(s));o={lineHeight:r.height(),style:r.css("font-style"),variant:r.css("font-variant"),weight:r.css("font-weight"),family:r.css("font-family"),color:r.css("color")};o.size=r.css("line-height",1).height();r.remove()}t=o.style+" "+o.variant+" "+o.weight+" "+o.size+"px "+o.family;n=m[w]={width:0,height:0,active:false,lines:[],font:{definition:t,color:o.color}};l.save();l.font=t;var x=(w+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(var q=0;q<x.length;++q){var v=x[q],u=l.measureText(v);n.width=Math.max(u.width,n.width);n.height+=o.lineHeight;n.lines.push({text:v,width:u.width,height:o.lineHeight})}l.restore()}return n};h.prototype.addText=function(p,s,q,t,l,m,o,r){if(!j.getOptions().canvas){return a.call(this,p,s,q,t,l,m,o,r)}var k=this.getTextInfo(p,t,l,m),v=k.lines;k.active=true;q+=k.height/v.length/2;if(r=="middle"){q=Math.round(q-k.height/2)}else{if(r=="bottom"){q=Math.round(q-k.height)}else{q=Math.round(q)}}if(!!(window.opera&&window.opera.version().split(".")[0]<12)){q-=2}for(var n=0;n<v.length;++n){var u=v[n];u.y=q;q+=u.height;if(o=="center"){u.x=Math.round(s-u.width/2)}else{if(o=="right"){u.x=Math.round(s-u.width)}else{u.x=Math.round(s)}}}}}f.plot.plugins.push({init:g,options:b,name:"canvas",version:"1.0"})})(jQuery);